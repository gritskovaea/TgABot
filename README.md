## TgABot

Telegram-бот и веб-интерфейс для аналитики сообщений в групповых чатах.

### 1. Запуск проекта

1) Клонируйте репозиторий:
```
git clone <repo_url>
cd TgABot
```

2) Заполните `.env`:
```
BOT_TOKEN=...
GEMINI_API_KEY=...
```

3) Запустите:
```
docker compose down -v
docker compose up --build
```

Примечание: `db.sql` применяется при первом старте Postgres (когда нет volume).
Бот ждёт готовности БД (waitForDb), чтобы не падать при старте.

### 2. Архитектура

- `bot/` — Telegram‑бот на Telegraf
- `web/tgabot/` — Next.js веб‑интерфейс
- `postgres` — хранение сообщений и пользователей
- `redis` — кэш статистики

**Технологии и почему:**
- `Node.js + TypeScript` — типизация и единый стек для бота и веба.
- `Telegraf` — простой и популярный SDK для Telegram‑ботов.
- `PostgreSQL` — надёжное хранение сообщений и пользователей.
- `Redis` — быстрый кэш для статистики.
- `Next.js` — минимальный UI и server‑API в одном приложении.

### 3. Принятые решения

- Храним сообщения в Postgres, без ORM, простые SQL‑запросы в `models/`.
- Кэшируем результаты статистики в Redis (TTL из `.env`).
- Авто‑инициализация БД через `db.sql` в Docker.

### 4. Ограничения проверки

- Gemini API может быть недоступен из региона РФ (ошибка `FAILED_PRECONDITION`).
- Логика интеграции реализована, но фактический ответ API проверить не удалось.

### 5. Использование AI

- Использовала AI для генерации базовой структуры, SQL, тестов.
- Сам допиливал интеграцию с Docker и логику статистики.
- AI ускорил рутинные части; основная доработка — дебаг и тестирование.

### Команды бота

- `/stats` — топ‑10 + фильтры + выбор пользователя
- `/stats @username` — статистика выбранного пользователя
- `/analyze` — анализ по reply
- `/analyze @username` — анализ по username
- `/myrank` — место пользователя в рейтинге

### Веб

- `http://localhost:3000` → ввод `@username` → анализ

### Тесты

```
cd bot
npm test
```
